<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>awdropthehot</title>
  <link rel="icon" href="data:," />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <main class="stage" aria-label="AW Drop The Hot">
    <video class="logo" src="./images/awSpinningLogo.webm" autoplay loop muted playsinline></video>

    <button class="menu-button" type="button" aria-expanded="false" aria-controls="menuPanel">
      <span class="menu-line"></span>
      <span class="menu-line"></span>
      <span class="menu-line"></span>
      <span class="sr-only">Menu</span>
    </button>

    <section id="menuPanel" class="menu-panel" aria-hidden="true">
      <button class="menu-close" type="button" aria-label="Close menu">✕</button>
      <div class="menu-content">
        <button class="menu-link info-trigger" type="button">INFO</button>
        <a class="menu-link" href="https://www.youtube.com/@awdropthehot" target="_blank" rel="noopener noreferrer">YOUTUBE</a>
        <a class="menu-link" href="https://www.instagram.com/awdropthehot/" target="_blank" rel="noopener noreferrer">INSTAGRAM</a>
        <a class="menu-link" href="https://soundcloud.com/awdropthehot" target="_blank" rel="noopener noreferrer">SOUNDCLOUD</a>
        <button class="menu-link music-toggle" type="button">TURN IT UP</button>
      </div>
    </section>

  </main>
  <footer class="footer">ⓒ 2000 AW. All Rights Reserved</footer>
  <section id="info" class="info">
    <div class="info-block">
      <h2>INFO</h2>
      <p>충남대학교 흑인음악∙서브컬처 동아리 AW입니다.</p>
      <p>AW is a Black music and subculture club at CNU.</p>
    </div>
    <div class="info-block">
      <h2>LOCATION</h2>
      <p>(34134) 대전광역시 유성구 대학로 99 1학생회관 지하 1층 B106 AW</p>
      <p>99 Daehak-ro, Yuseong-gu, Daejeon 34134, Republic of Korea</p>
    </div>
    <div class="info-block">
      <h2>SUPPLY</h2>
      <p>인스타그램 DM 또는 이메일로 간단한 자기소개를 보내주세요.</p>
      <p>Please send a brief self-introduction via Instagram DM or email.</p>
      <p>awdropthehot@gmail.com</p>
    </div>
  </section>

  <script>
    const menuButton = document.querySelector('.menu-button');
    const menuPanel = document.querySelector('#menuPanel');
    const menuClose = document.querySelector('.menu-close');
    const infoButton = document.querySelector('.info-trigger');
    const logoVideo = document.querySelector('.logo');
    const musicToggle = document.querySelector('.music-toggle');

    const openMenu = () => {
      menuPanel.setAttribute('aria-hidden', 'false');
      menuButton.setAttribute('aria-expanded', 'true');
      menuPanel.classList.add('open');
    };

    const closeMenu = () => {
      menuPanel.setAttribute('aria-hidden', 'true');
      menuButton.setAttribute('aria-expanded', 'false');
      menuPanel.classList.remove('open');
    };

    menuButton.addEventListener('click', () => {
      if (menuPanel.classList.contains('open')) {
        closeMenu();
      } else {
        openMenu();
      }
    });

    menuPanel.addEventListener('click', (event) => {
      if (event.target === menuPanel) {
        closeMenu();
      }
    });

    menuClose.addEventListener('click', closeMenu);
    infoButton.addEventListener('click', () => {
      closeMenu();
      document.querySelector('#info')?.scrollIntoView({ behavior: 'smooth' });
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && menuPanel.classList.contains('open')) {
        closeMenu();
      }
    });

    const ensureVideoPlaying = () => {
      if (!logoVideo) return;
      const tryPlay = () => {
        if (logoVideo.ended) {
          logoVideo.currentTime = 0;
        }
        const playPromise = logoVideo.play();
        if (playPromise && typeof playPromise.catch === 'function') {
          playPromise.catch(() => {});
        }
      };
      if (logoVideo.readyState >= 2) {
        tryPlay();
      } else {
        logoVideo.addEventListener('loadeddata', tryPlay, { once: true });
      }
    };

    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) {
        ensureVideoPlaying();
      }
    });

    window.addEventListener('pageshow', (event) => {
      if (event.persisted && logoVideo) {
        logoVideo.load();
      }
      ensureVideoPlaying();
    });

    window.addEventListener('focus', ensureVideoPlaying);
    ensureVideoPlaying();

    const musicFiles = [
      'Award Tour.mp3',
    ];
    const musicTracks = musicFiles.map((name) => `./musics/${encodeURIComponent(name)}`);
    const musicPlayer = new Audio();
    musicPlayer.preload = 'auto';
    let isPlaying = false;
    let currentTrack = 0;

    const updateMusicButton = () => {
      if (!musicToggle) return;
      musicToggle.textContent = isPlaying ? 'CUT IT OFF' : 'TURN IT UP';
      musicToggle.setAttribute('aria-pressed', isPlaying ? 'true' : 'false');
    };

    const playTrack = (index) => {
      currentTrack = index % musicTracks.length;
      musicPlayer.src = musicTracks[currentTrack];
      const playPromise = musicPlayer.play();
      if (playPromise && typeof playPromise.catch === 'function') {
        playPromise.catch(() => {});
      }
    };

    musicPlayer.addEventListener('ended', () => {
      if (!isPlaying || musicTracks.length === 0) return;
      playTrack((currentTrack + 1) % musicTracks.length);
    });

    if (musicToggle) {
      musicToggle.addEventListener('click', () => {
        if (musicTracks.length === 0) return;
        if (isPlaying) {
          musicPlayer.pause();
          isPlaying = false;
        } else {
          if (!musicPlayer.src) {
            playTrack(currentTrack);
          } else {
            const playPromise = musicPlayer.play();
            if (playPromise && typeof playPromise.catch === 'function') {
              playPromise.catch(() => {});
            }
          }
          isPlaying = true;
        }
        updateMusicButton();
      });
    }

    updateMusicButton();
  </script>
</body>
</html>
